// Isso define que vamos usar Javascript/Typescript e MySQL
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql" // Se estiver usando SQLite no mobile local, mude para "sqlite"
  url      = env("DATABASE_URL")
}

// --- TABELAS DO SISTEMA ---

model Usuario {
  id            Int         @id @default(autoincrement())
  nomeCompleto  String
  email         String      @unique
  senha         String
  tipo          TipoUsuario @default(PACIENTE)
  telefone      String?
  fotoPerfilUrl String?
  
  // --- NOVOS CAMPOS DO CADASTRO ---
  dataNascimento String?
  sexo           String?   // "M" ou "F"
  altura         Float?    // ex: 1.75
  objetivos      String?   // ex: "SAUDE,EMAGRECER"
  // -------------------------------

  dataCriacao    DateTime @default(now())

  // Relacionamentos
  agendamentos    Agendamento[]
  metas           MetaSaude?
  diarios         DiarioDiario[]
  planos          PlanoNutricional[]

  @@map("tb_usuarios")
}

model MetaSaude {
  id                 Int     @id @default(autoincrement())
  usuarioId          Int     @unique // Um usuario s贸 tem uma meta ativa
  usuario            Usuario @relation(fields: [usuarioId], references: [id])
  pesoAtual          Float
  pesoMeta           Float
  // Altura removida daqui pois agora fica no Usuario
  metaCaloricaDiaria Int // ex: 2000 kcal
  metaAguaDiaria     Int // ex: 2500 ml

  @@map("tb_metas_saude")
}

model Agendamento {
  id               Int      @id @default(autoincrement())
  usuarioId        Int
  usuario          Usuario  @relation(fields: [usuarioId], references: [id])
  dataHoraConsulta DateTime
  valorPago        Decimal?  @db.Decimal(10, 2) // Deixei opcional (?) pra facilitar testes
  formaPagamento   FormaPagamento
  status           StatusAgendamento @default(AGUARDANDO_PAGAMENTO)
  observacoes      String?

  //  NOVOS CAMPOS ADICIONADOS
  tipoConsulta     TipoConsulta @default(PRESENCIAL)
  linkMeet         String?      // Link do Google Meet (S贸 se for online)
  endereco         String?      // Endere莽o do consult贸rio (S贸 se for presencial)

  @@map("tb_agendamentos")
}

model PlanoNutricional {
  id          Int      @id @default(autoincrement())
  usuarioId   Int
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  titulo      String
  arquivoUrl  String?  // Link do PDF
  descricao   String?  // Texto se n茫o tiver PDF
  dataUpload  DateTime @default(now())

  @@map("tb_planos_nutricionais")
}

model Receita {
  id             Int    @id @default(autoincrement())
  titulo         String
  ingredientes   String @db.Text
  modoPreparo    String @db.Text
  caloriasTotais Int
  fotoUrl        String?
  categoria      String // ex: "Cafe da Manha"

  @@map("tb_receitas")
}

model DiarioDiario {
  id                 Int      @id @default(autoincrement())
  usuarioId          Int
  usuario            Usuario  @relation(fields: [usuarioId], references: [id])
  dataRegistro       DateTime @default(now())
  caloriasConsumidas Int
  caloriasQueimadas  Int
  aguaConsumida      Int      // em ml
  observacoesDia     String?

  @@map("tb_diario_diario")
}

// --- ENUMS (Op莽玫es fixas) ---

enum TipoUsuario {
  ADMIN
  NUTRICIONISTA  // Adicionado
  PACIENTE
}

enum FormaPagamento {
  PIX
  CARTAO
}

enum StatusAgendamento {
  AGUARDANDO_PAGAMENTO
  AGENDADO             // Adicionei esse status comum
  CONFIRMADO
  REALIZADO
  CANCELADO_COM_CREDITO
  CANCELADO
}

enum TipoConsulta { // Novo Enum
  ONLINE
  PRESENCIAL
}